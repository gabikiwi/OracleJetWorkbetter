/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","promise","ojs/ojcustomelement","ojs/ojcomposite-knockout"],function(a){a.Ib={};a.Ib.hr=Object.create(a.ia.hr);a.Bc.we(a.Ib.hr,{jS:function(b){b.setProperty=function(b,c){if(a.kd.KC(b))this[b]=c;else{var f=this.getProperty(b),g=a.ia.jc(this),k=a.ia.UC(g),l=b.split("."),m=a.ia.PE(b,k);if(m||1!=l.length){if(k[l[0]].readOnly)throw"Read-only property "+b+" cannot be set on "+this.tagName;a.ia.OE(this,b,c,m);a.ia.uL(g.Uz.bind(g),this,b,c);g.A8&&-1!==b.indexOf(".")&&a.Ib.iX(this,b,
c,f,"external")}else a.F.error("Ignoring property set for undefined property "+b+" on "+this.tagName)}};b.getProperty=function(b){var c=a.kd.KC(b);return c?c:-1!==b.indexOf(".")?a.ia.o9(this,b):this[b]};b._propsProto.setProperty=function(b,c){var f=this.getProperty(b),g=a.ia.PE(b,a.ia.UC(this.mA));g||-1!==b.indexOf(".")?(a.ia.OE(this.Mw,b,c,g),a.ia.uL(this.mA.Uz.bind(this.mA),this,b,c),-1!==b.indexOf(".")&&a.Ib.iX(this.Mw,b,c,f,"internal")):a.F.error("Ignoring property set for undefined property "+
b+" on "+this.Mw.tagName)};b._propsProto.getProperty=function(b){return-1!==b.indexOf(".")?a.ia.o9(this,b):this[b]};b.getNodeBySubId=function(b){var c=a.ia.jc(this);return c.IA.getNodeBySubId?c.IA.getNodeBySubId(b,c.ida.bind(this)):c.ida.bind(this)(b)};b.getSubIdByNode=function(b){var c=a.ia.jc(this);return c.IA.getSubIdByNode?c.IA.getSubIdByNode(b,c.Gda.bind(this)):c.Gda.bind(this)(b)}},vS:function(b,c,e){b[c]=function(){var b=e.internalName||c;return a.ia.jc(this).IA[b].apply(null,arguments)}},
wS:function(b,c,e){function f(a){g.bind(this)(a,!1)}function g(b,f){var h=a.Ib.hY(this.mA,c),p=h.peek();p!==b&&(a.ia.OE(this.Mw,c,b,e),h(b),e.DM&&(h=a.kd.KC(c),p&&this.Mw.removeEventListener(h,p),b&&b instanceof Function&&this.Mw.addEventListener(h,b)),!e.BW&&(!f||f&&this.mA.A8)&&a.Ib.iX(this.Mw,c,b,p,f?"external":"internal"))}e.BW||a.Ib.Waa(b._propsProto,c,function(){var b=a.Ib.hY(this.mA,c)();return null==b?e.value:b},f);a.Ib.Waa(b,c,function(){var b=a.ia.jc(this),b=a.Ib.hY(b,c).peek();return null==
b?e.value:b},function(b){if(e.readOnly)throw"Read-only property "+c+" cannot be set on "+this.tagName;var f=a.ia.jc(this);g.bind(f.Dp)(b,!0)})},$D:function(a){return a._metadata},NS:function(b){a.ia.p9(b,this.Dp,a.ia.UC(this),this.bK);this.FS().Cz()},OS:function(b,c){if(this.Rw){var e=this;this.Bsa=this.Rw.then(function(b){return a.Lh.eD(b,"activatedMethod",[e.TU])})}this.vU.Cz(this.Dp);var f={},g=a.Lh.EOa(b),k;for(k in g)f[k]=g[k].length;this.dva=g;this.G8.Cz(f);e=this;Promise.all([this.zva,this.Rw,
this.vU.xI(),this.Psa,this.Bsa]).then(function(g){g=g[0];if(!g)throw"ojComposite is missing a View";a.Lh.ZSa({props:e.Dp,LTa:e.dva,MTa:f,unique:e.TU.unique,hw:e.IA,Yqa:e.TU},b,g,c);a.Ib.wx("ready",b);e.A8=!0;e.QJ().Cz()})},I5:function(b){this.Rw&&this.Rw.then(function(c){a.Lh.eD(c,"disposeMethod",[b])})},PS:function(b){a.Ib.wx("pending",b);var c=a.ia.WU(b.tagName);if(!c)throw"Composite is missing a descriptor";this.Dw=this.$D(c);this.bK=c.parseFunction;b._propsProto&&(this.Dp=Object.create(b._propsProto),
this.Dp.mA=this,this.Dp.Mw=b);this.vU=new a.ia.sL;this.G8=new a.ia.sL;var e={element:b,props:this.vU.xI(),slotNodeCounts:this.G8.xI(),unique:a.Ib.UCa()};this.TU=e;if(b=a.Ib.nN(c,"viewModel")){var f=this;this.Rw=b.then(function(b){b="function"===typeof b?new b(e):a.Lh.eD(b,"initializeMethod",[e])||b;return f.IA=b})}if(b=a.Ib.nN(c,"view"))this.zva=b.then(function(b){return a.Ib.xBa(b)});if(c=a.Ib.nN(c,"css"))this.Psa=c.then(function(a){var b=document.createElement("style");b.type="text/css";b.styleSheet?
b.styleSheet.cssText=a:b.appendChild(document.createTextNode(a));document.head.appendChild(b)})},QS:function(b){this.Rw&&this.Rw.then(function(c){a.Lh.eD(c,"detachedMethod",[b])})},M5:function(a){Object.defineProperty(a,"_propsProto",{value:{}})},ida:function(b){var c=a.Ib.Dva(this)[b.subId];return c?c.alias?(b=a.Bc.we({},b,void 0,!0),b.subId=c.alias,c=c.node,c.getNodeBySubId?c.getNodeBySubId(b):a.Components.md(c)("getNodeBySubId",b)):c.node:null},Gda:function(b){if(!this.contains(b))return null;
var c=a.Ib.Cva(this),e=a.fk.nma(b,this);if(null!=e){var f=e.Fn.getAttribute("data-oj-subid-map");return(c=c[f])&&e.getSubIdByNode&&(b=e.getSubIdByNode(b))?(b.subId=c.map[b.subId],b):null}for(e=b;e!==this&&!(f=e.getAttribute("data-oj-subid-map")||e.getAttribute("data-oj-subid"));)e=e.parentNode;if(c=c[f])if(c.map){if(f=c.node,b=f.getSubIdByNode?f.getSubIdByNode(b):a.Components.md(f)("getSubIdByNode",b))return b.subId=c.map[b.subId],b}else return{subId:f};return null}});a.Ib.register=function(b,c){a.ia.s9(b,
c,a.Ib.hr)&&a.Ib.getMetadata(b).then(function(e){var f=e.name;f?b!=f&&a.F.warn("Registered property tagName: %s does not match name: %s provided in metadata.",b,f):a.F.warn('Required property "name" missing from metadata for %s.',b);e.version||a.F.warn('Required property "version" missing from metadata for %s.',b);e.jetVersion||a.F.warn('Required composite "jetVersion" missing from metadata for %s.',b);c._metadata=a.ia.r9(e,!1);document.registerElement(b.toLowerCase(),{prototype:a.Ib.hr.Nma(c)})})};
a.Ib.getMetadata=function(b){var c=a.ia.WU(b);if(c){var e=c._metadataPromise;e||(e=a.Ib.nN(c,"metadata"),e||(a.F.warn("Required metadata is missing for "+b),e=Promise.resolve({})),c._metadataPromise=e);return e}return null};a.Ib.Waa=function(a,c,e,f){Object.defineProperty(a,c,{enumerable:!0,get:e,set:f})};a.Ib.wx=function(a,c){c.dispatchEvent(new CustomEvent(a,{bubbles:!0}))};a.Ib.iX=function(a,c,e,f,g){var k={},l=c.split("."),m=c,p=e,t=f;1<l.length&&(m={},m.path=c,m.value=e,m.previousValue=f,k.subproperty=
m,m=l[0],t=p=a[m]);k.value=p;k.previousValue=t;k.updatedFrom=g;a.dispatchEvent(new CustomEvent(m+"-changed",{detail:k}));a.dispatchEvent(new CustomEvent(m+"Changed",{detail:k}))};a.Ib.xBa=function(b){if("string"===typeof b){var c=document.createElement("div");c.innerHTML=b;for(var e=[],f=0;f<c.childNodes.length;f++)e.push(c.childNodes[f]);return e}if(a.Ib.sGa(b)){e=[];for(f=0;f<b.childNodes.length;f++)e.push(b.childNodes[f]);return e}if(Array.isArray(b))return b.splice(0);throw"The View ("+b+") has an unsupported type";
};a.Ib.bca=function(b,c){if(!b.I8){for(var e={},f={},g=c.children,k=0;k<g.length;k++)a.Ib.Lka(e,f,g[k]);b.jua=f;b.I8=e}};a.Ib.Lka=function(b,c,e){if(!e.hasAttribute("slot")&&(a.Ib.fwa(b,c,e),!a.ia.Dv(e.tagName)&&!a.Components.md(e))){e=e.children;for(var f=0;f<e.length;f++)a.Ib.Lka(b,c,e[f])}};a.Ib.fwa=function(a,c,e){var f=e.getAttribute("data-oj-subid"),g=e.getAttribute("data-oj-subid-map");if(g){if(f=JSON.parse(g),"object"===typeof f&&!(f instanceof Array)){var k={},l;for(l in f)a[l]={alias:f[l],
node:e},k[f[l]]=l;c[g]={map:k,node:e}}}else f&&(a[f]={node:e},c[f]={node:e})};a.Ib.Dva=function(b){var c=a.ia.jc(b);a.Ib.bca(c,b);return c.I8};a.Ib.Cva=function(b){var c=a.ia.jc(b);a.Ib.bca(c,b);return c.jua};a.Ib.hY=function(b,c){b.kL||(b.kL={});b.kL[c]||(b.kL[c]=a.Lh.TOa());return b.kL[c]};a.Ib.nN=function(a,c){var e=null,f=a[c];if(null!=f){e=Object.keys(f)[0];f=f[e];if(null==e)throw"Invalid component descriptor key";switch(e){case "inline":e=Promise.resolve(f);break;case "promise":e=f;break;default:throw"Invalid descriptor key "+
e+" for the resource type: "+c;}}return e};a.Ib.UCa=function(){return c+g++};a.Ib.sGa=function(a){return window.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType};a.Ib.Xfa=function(a){return 1===a.nodeType||3===a.nodeType};var g=0,c="_ojcomposite";a.fk={};a.fk.sd={initializeMethod:"initialize",activatedMethod:"activated",attachedMethod:"attached",bindingsAppliedMethod:"bindingsApplied",detachedMethod:"detached",disposeMethod:"dispose"};o_("Composite.defaults",a.fk.sd,a);a.fk.getMetadata=
function(b){return a.Ib.getMetadata(b)};o_("Composite.getMetadata",a.fk.getMetadata,a);a.fk.register=function(b,c){a.Ib.register(b,c)};o_("Composite.register",a.fk.register,a);a.fk.nma=function(b,c){for(var e=null;b;)if(b=a.Lh.EPa(b)){if(c&&!(b.compareDocumentPosition(c)&16))break;e=b}return e};a.fk.m9="__oj_composite"});