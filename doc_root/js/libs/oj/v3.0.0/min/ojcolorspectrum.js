/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","knockout","jquery","ojs/ojcomponentcore","ojs/ojcolor","ojs/ojslider","jqueryui-amd/widgets/draggable","ojs/ojtouchproxy","ojs/ojeditablevalue"],function(a,g,c){(function(){function b(a){var b;b=a.bz();var c=a.Yy(),g=a.Vy();b/=255;var c=c/255,g=g/255,k=Math.max(b,c,g),l=Math.min(b,c,g),m,p=(k+l)/2;if(k==l)m=l=0;else{var t=k-l,l=.5<p?t/(2-k-l):t/(k+l);switch(k){case b:m=(c-g)/t+(c<g?6:0);break;case c:m=(g-b)/t+2;break;case g:m=(b-c)/t+4}m/=6}b=[m,l,p];b[0]*=360;b[1]*=100;b[2]*=
100;b.push(a.Ty());return b}a.ab("oj.ojColorSpectrum",c.oj.editableValue,{widgetEventPrefix:"oj",defaultElement:"\x3cinput\x3e",options:{value:null,rawValue:null,disabled:!1},getNodeBySubId:function(a){if(null==a)return this.element?this.element[0]:null;var b=null;switch(a.subId){case "oj-spectrum":b=this.zm[0];break;case "oj-spectrum-thumb":b=this.$e[0];break;case "oj-hue-slider-bar":b=this.Fl.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-hue-slider-bar-value":b=this.Fl.ojSlider("getNodeBySubId",
{subId:"oj-slider-bar-value"});break;case "oj-hue-slider-thumb":b=this.Fl.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"});break;case "oj-opacity-slider-bar":b=this.El.ojSlider("getNodeBySubId",{subId:"oj-slider-bar"});break;case "oj-opacity-slider-bar-value":b=this.El.ojSlider("getNodeBySubId",{subId:"oj-slider-bar-value"});break;case "oj-opacity-slider-thumb":b=this.El.ojSlider("getNodeBySubId",{subId:"oj-slider-thumb-0"})}return b},getSubIdByNode:function(a){a=c(a);var b=null,f;a.hasClass("oj-colorspectrum-spectrum")?
b="oj-spectrum":a.hasClass("oj-colorspectrum-thumb")?b="oj-spectrum-thumb":(f=a.closest(".oj-slider"),f=f.hasClass("oj-slider-vertical")?"hue":"opacity",a.hasClass("oj-slider-bar")?b="oj-"+f+"-slider-bar":a.hasClass("oj-slider-bar-value")?b="oj-"+f+"-slider-bar-value":a.hasClass("oj-slider-thumb")&&(b="oj-"+f+"-slider-thumb"));return{subId:b}},_destroy:function(){this.Lg&&(this.Jxa(),this.yza(),this.LJa(),this.Lg.removeClass("oj-colorspectrum"),this.nx());this._super()},_ComponentCreate:function(){this._super();
this.LFa()},Mg:function(){this._super();var b=this.FK();b?(b=b.attr("id"))?this.$e.attr("aria-labelledby",b):a.F.warn("JET Color Spectrum: The label for this component needs an id in order to be accessible"):(b=this.element.attr("aria-label"))&&this.$e.attr("aria-label",b)},_setOption:function(a,b,c){switch(a){case "value":this.p0(b);break;case "disabled":this.EH(b,!0)}this._super(a,b,c)},Ml:function(b,c){if("string"===typeof b)try{b=new a.o(b)}catch(f){a.F("ojColorSpectrum: invalid rawValue ("+b+
"), defaulting to black"),b=a.o.BLACK}var g={};g._context={originalEvent:c,xd:!0,kb:!0,readOnly:!0};this.hya(this.options.rawValue,b)||this.option("rawValue",b,g)},hya:function(a,b){return a.bz()===b.bz()&&a.Yy()===b.Yy()&&a.Vy()===b.Vy()&&a.Ty()===b.Ty()},$L:function(b,c){var f=c instanceof a.o;return b instanceof a.o&&f&&b.isEqual(c)},EH:function(a,b){var c=!b||b&&a!==this.Pp;c&&(this.mAa(!a),a?(this.element.addClass("oj-disabled"),this.xga(!1)):(this.element.removeClass("oj-disabled"),this.xga(!0)),
this.Pp=a);return c},p0:function(b){b instanceof a.o&&!this.$L(this.uf,b)&&(this.Nia(b),this.lja(this.fq,!0),this.lja(this.eo,!1),this.t0(this.fq,this.dC,this.NB,this.eo,!0))},Vga:function(b,e){var f,g,k,l,m;if(this.Ija&&("rawValue"==e.option||"value"==e.option)&&void 0!==e.value&&("value"==e.option&&(this.Ofa=!!b.originalEvent),g=c(b.target),f=g.hasClass("oj-colorspectrum-hue"),g=g.hasClass("oj-colorspectrum-alpha"),f||g)){g=this.fq;k=this.dC;l=this.NB;m=this.eo;f?(g=e.value,this.sP(g,k,l),this.t0(g,
k,l,m,!1)):(m=e.value,this.xH(g,k,l,m));f=new a.o({h:g,s:k,l:l,a:m});if(b.originalEvent||this.Ofa)this.Ofa=!1,"rawValue"===e.option?this.Ml(f,b):"value"===e.option&&this.bc(f,b);this.Nia(f)}},lja:function(a,b){(b?this.Fl:this.El).ojSlider("option","value",a)},t0:function(a,b,c,g,k){this.zm.css("background-color","hsl("+a+", 100%, 50%)");k&&(k=this.GCa(b,c),this.gC(k.x,k.y));this.xH(a,b,c,g)},ILa:function(){var b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)";
switch(a.Sa.en().browser){case a.Sa.lj.NJ:b="moz";break;default:b="webkit";break;case a.Sa.lj.cE:b="ms"}b=" -___-linear-gradient(top, hsl(0, 0%, 100%) 0%, hsla(0, 0%, 100%, 0) 50%, hsla(0, 0%, 0%, 0) 50%, hsl(0, 0%, 0%) 100%), -___-linear-gradient(left, hsl(0, 0%, 50%) 0%, hsla(0, 0%, 50%, 0) 100%)".replace(/___/g,b);this.zm.css("backgroundImage",b)},gC:function(a,b){isNaN(a)||(this.jv=a);isNaN(b)||(this.kv=b);this.Jga(0,0)},GCa:function(a,b){var c=Math.min(a/100*this.Bs,this.Bs),g=this.Io-Math.min(b/
100*this.Io,this.Io);return{x:Math.round(c),y:Math.round(g)}},Jga:function(a,b){var c,g;c=this.jv+a;g=this.kv+b;0>c&&(c=0);0>g&&(g=0);c>=this.Bs&&(c=this.Bs-1);g>=this.Io&&(g=this.Io-1);this.jv=c;this.kv=g;c=c-this.Mk+"px";g=g-this.Mk+"px";this.$e[0].style.left=c;this.$e[0].style.top=g},gMa:function(b){if(!this.Pp){var c=this.zm.offset(),f=b.pageX-c.left,c=b.pageY-c.top,g,k,l,f=Math.round(f),c=Math.round(c);g=this.jY(f,c);k=g.SR;l=g.B3;g=this.fq;this.sP(g,k,l);var m=new a.o({h:g,s:k,l:l,a:this.eo});
this.Ml(m,b);this.bc(m,b);this.xH(g,k,l,this.eo);this.uf=m;this.kja(k,l);this.gC(f,c);this.$e.focus()}},VGa:function(a){var b,c,g,k=1;this.hga=(new Date).getTime();0>this.Ku&&(this.Ku=this.hga,this.gga=0);b=this.hga-this.Ku;this.gga++;if(1400<b||25<this.gga)k=3;c=g=0;b=a.keyCode;if(40==b)g=k;else if(38==b)g=-k;else if(39==b)c=k;else if(37==b)c=-k;else if(36==b)this.gC(0,0),this.Ku=-1;else if(35==b)this.gC(this.Bs-1,this.Io-1),this.Ku=-1;else if(33==b)this.gC(NaN,0),this.Ku=-1;else if(34==b)this.gC(NaN,
this.Io-1),this.Ku=-1;else return;this.Jga(c,g);this.Bea(a,this.jv,this.kv);a.preventDefault();return!1},XGa:function(a){this.Ku=-1;var b=this.jY(this.jv,this.kv);this.xH(this.fq,b.SR,b.B3,this.eo);this.bc(this.options.rawValue,a)},UFa:function(){this.zm[0].getBoundingClientRect();this.T0||(this.T0=this.yMa.bind(this));this.$e.draggable({drag:this.T0,stop:this.T0})},xga:function(a){this.$e.draggable(a?"enable":"disable")},yMa:function(a,b){var c,g,k,l;b.position.left<-this.Mk?(b.position.left=-this.Mk,
c=0):b.position.left+this.Mk>=this.Bs&&(b.position.left=this.Bs-1-this.Mk,g=this.Bs-1);b.position.top<-this.Mk?(b.position.top=-this.Mk,g=0):b.position.top+this.Mk>=this.Io&&(b.position.top=this.Io-1-this.Mk,g=this.Io-1);k=this.$e.offset();l=this.zm.offset();0!=c&&(c=k.left+this.Mk-l.left);0!=g&&(g=k.top+this.Mk-l.top);if(this.jv!==c||this.kv!==g)"drag"===a.type?(this.jv=c,this.kv=g):(c=this.jv,g=this.kv),this.Bea(a,c,g)},Bea:function(b,c,f){var g,k,l=!1;g=this.fq;f=this.jY(c,f);c=f.SR;f=f.B3;this.sP(g,
c,f);k=new a.o({h:g,s:c,l:f,a:this.eo});this.Ml(k,b);"dragstop"===b.type&&(this.bc(k,b.originalEvent),l=!0);this.uf=k;this.kja(c,f);l&&this.xH(g,c,f,this.eo)},jY:function(a,b){return{SR:a/(this.Bs-1)*100,B3:100-b/(this.Io-1)*100}},sP:function(a,b,c){var g="hsla("+a+","+b+"%,"+c+"%, 0)";b="hsla("+a+","+b+"%,"+c+"%, 1.0)";this.IB&&(a=b,b=g,g=a);this.GW=a="linear-gradient(90deg, "+g+", "+b+"),"+this.gV;this.oK.css("background",a)},CCa:function(a,b,c,g){var k="number"===typeof g&&1>g;a=Math.round(a);
b=Math.round(100*b)/100;c=Math.round(100*c)/100;return a="hsl"+(k?"a(":"(")+(a+", "+b+"%, "+c+"%"+(k?","+g:"")+")")},kja:function(a,b){this.dC=a;this.NB=b},Nia:function(a){a&&(this.uf=a,a=b(a),this.fq=a[0],this.dC=a[1],this.NB=a[2],this.eo=a[3])},xH:function(a,b,c,g){this.$e.attr("aria-valuetext",this.CCa(a,b,c,g))},LFa:function(){this.qG();this.hb()},hb:function(){this.Lg.append(this.IG);this.Lg.addClass("oj-colorspectrum");c(".oj-colorspectrum-hue").uniqueId();c(".oj-colorspectrum-alpha").uniqueId();
this.Lg.find(".oj-colorspectrum-container");this.Fl=this.Lg.find(".oj-colorspectrum-hue");this.El=this.Lg.find(".oj-colorspectrum-alpha");this.zm=this.Lg.find(".oj-colorspectrum-spectrum");this.$e=this.Lg.find(".oj-colorspectrum-thumb");this.Mk=this.$e[0].offsetWidth/2;0>=this.Mk&&(this.Mk=this.$e.width()/2);this.Yx=a.Q.Ne();this.Bs=this.zm.width();this.Io=this.zm.height();this.$e.attr("aria-describedby",this.Lg.find(".oj-colorspectrum-thumb-description").uniqueId().attr("id"));this.gV="url('"+a.qa.tb("common/images/spectrum-opacity-slider-bg.png")+
"')";this.gV=this.gV.replace("js","css");var d=this.Pp?!0:!1,e=b(this.uf);this.fq=e[0];this.dC=e[1];this.NB=e[2];this.eo=e[3];this.Ija=!1;this.Fl.ojSlider({max:360,min:0,step:1,value:this.fq,orientation:"vertical",optionChange:this.Vga.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal","");this.El.ojSlider({max:1,min:0,step:.01,value:this.eo,orientation:"horizontal",optionChange:this.Vga.bind(this),rootAttributes:{"class":"oj-slider-color-picker"}}).attr("data-oj-internal",
"");this.SFa();this.ILa();this.t0(this.fq,this.dC,this.NB,this.eo,!0);this.zm.click(this.gMa.bind(this));this.UFa();this.EH(d);this.$e.keydown(this.VGa.bind(this));this.$e.keyup(this.XGa.bind(this));this.zm.focus(this.XHa.bind(this));this._focusable({element:this.$e,SVa:!0});a.Q.Ne()&&this.A0(this.$e)},XHa:function(){this.$e.focus();return!1},SFa:function(){var a={subId:"oj-slider-bar"};this.pK=c(this.Fl.ojSlider("getNodeBySubId",a));this.oK=c(this.El.ojSlider("getNodeBySubId",a));a.EWa="oj-slider-bar-value";
c(this.Fl.ojSlider("getNodeBySubId",a));c(this.El.ojSlider("getNodeBySubId",a));this.pK.css("background","linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)");this.HW="linear-gradient(0deg, #ff0000 0%, #ffff00 17%, #00ff00 33%, #00ffff 50%, #0000ff 67%, #ff00ff 83%, #ff0000 100%)";this.sP(this.fq,this.dC,this.NB);this.Ija=!0},qG:function(){this.kV();this.kv=this.jv=0;var a=this.Wf(this.R("labelHue")),b=this.Wf(this.R("labelOpacity"));this.IG=
["\x3cdiv class\x3d'oj-colorspectrum-container'\x3e\x3cdiv class\x3d'oj-colorspectrum-spectrum' tabindex\x3d'-1' style\x3d'position:relative'\x3e\x3cdiv class\x3d'oj-colorspectrum-thumb' role\x3d'slider' aria-describedby\x3d'' style\x3d'position:absolute;top:-9999px;left:-9999px;' tabIndex\x3d'0'\x3e\x3c/div\x3e\x3c/div\x3e","\x3cdiv class\x3d'oj-colorspectrum-thumb-description oj-helper-hidden-accessible'\x3e"+this.Wf(this.R("labelThumbDesc"))+"\x3c/div\x3e","\x3cinput class\x3d'oj-colorspectrum-hue' aria-label\x3d'"+
a+"'\x3e\x3c/input\x3e","\x3cinput class\x3d'oj-colorspectrum-alpha' aria-label\x3d'"+b+"'\x3e\x3c/input\x3e","\x3c/div\x3e"].join("");this.Ku=-1;this.IB="rtl"===this.rd()},kV:function(){var b=this.options,e;this.Lg=c(this.element);this.Pp=!1;e=b.value;e instanceof a.o||(e=null);this.uf=e?e:a.o.BLACK;b.rawValue=this.uf;e=b.disabled;this.Pp="boolean"===typeof e?e:!1},aga:function(a){var b=a.bz(),c=a.Yy(),g=a.Vy();a=a.Ty();return 0===b&&0===c&&0===g&&0===a},mAa:function(a){var b=!a;a?(this.Fl.ojSlider("option",
"disabled",b),this.El.ojSlider("option","disabled",b),b={subId:"oj-slider-bar"},this.Fl=this.Lg.find(".oj-colorspectrum-hue"),this.El=this.Lg.find(".oj-colorspectrum-alpha"),this.pK=c(this.Fl.ojSlider("getNodeBySubId",b)),this.oK=c(this.El.ojSlider("getNodeBySubId",b)),this.GW&&this.oK.css("background",this.GW),this.HW&&this.pK.css("background",this.HW)):((a=this.pK.css("background"))&&0<a.length&&(this.HW=a),(a=this.oK.css("background"))&&0<a.length&&(this.GW=a),this.Fl.ojSlider("option","disabled",
b),this.El.ojSlider("option","disabled",b))},yza:function(){this.Fl.ojSlider("destroy");this.El.ojSlider("destroy")},LJa:function(){this.Lg.empty()},Jxa:function(){this.zm.off("click");this.$e.off("mousedown");this.$e.off("keydown");this.$e.off("keyup");this.VH&&this.Q0(this.$e)},nx:function(){this.IG=this.Lg=this.Fl=this.El=this.zm=this.$e=null},A0:function(b){this.VH=a.sg.M1(b)},Q0:function(b){a.sg.t4(b)},_GetMessagingLauncherElement:function(){return this.element},Xf:function(){return this.$e},
Pt:function(){return this.uf},rk:function(b){this.uf="string"===typeof b?new a.o(b):b},Zh:function(){return this.uf.toString()},_GetDefaultStyleClass:function(){return"oj-colorspectrum"},Wf:function(a){return c("\x3cspan\x3e"+a+"\x3c/span\x3e").text()}})})()});