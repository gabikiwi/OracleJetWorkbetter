/**
 * Copyright (c) 2014, 2017, Oracle and/or its affiliates.
 * The Universal Permissive License (UPL), Version 1.0
 */
"use strict";
define(["ojs/ojcore","jquery"],function(a,g){a.Sf=function(a,b,d){d=d||{};this.p=b;this.zj=g(a)[0];this.gB=d.fetchSize;this.gB=0<this.gB?this.gB:25;this.PB=d.maxCount;this.PB=0<this.PB?this.PB:500;this.mq=0;this.Rja=d.success;this.oAa=d.error;this.ry();this.vx=d.fetchTrigger;if(null==this.vx||isNaN(this.vx))this.vx=0;this.aGa=this.zj.scrollTop;g(this.rN()).on("scroll.domscroller",function(){var a=this.zj,b=this.HCa(a),a=a.scrollHeight-a.clientHeight;0<a&&this.$Y(b,a)}.bind(this))};a.Sf.prototype.rN=
function(){return this.zj==document.body||this.zj==document.documentElement?window:this.zj};a.Sf.fOa=function(a,b){for(var d=0,e=b;e&&e!=a&&g.contains(a,e);)d+=e.offsetTop,e=e.offsetParent;return d};a.Sf.prototype.HCa=function(a){var b=this.vx;return a==document.documentElement&&(void 0===this.Fka&&(this.Fka=this.aGa==a.scrollTop?!0:!1),this.Fka)?b+document.body.scrollTop:b+a.scrollTop};a.Sf.prototype.destroy=function(){this.wq();g(this.rN()).off("scroll.domscroller")};a.f.j("DomScroller.prototype.destroy",
{destroy:a.Sf.prototype.destroy});a.Sf.prototype.checkViewport=function(){return 0<this.zj.clientHeight&&!this.Axa()?this.Nba():Promise.resolve(null)};a.f.j("DomScroller.prototype.checkViewport",{checkViewport:a.Sf.prototype.checkViewport});a.Sf.prototype.$Y=function(a,b){if(1>=b-a&&!this.HF){var d=this;this.Nba().then(function(a){null!=d.Rja&&d.Rja(a)},this.oAa)}};a.Sf.prototype.Axa=function(){var a=this.zj;return a.scrollHeight>a.clientHeight+this.vx?!0:!1};a.Sf.prototype.Nba=function(){if(this.HF)return this.HF;
var a=this.PB-this.mq;if(0<a){var b=this.gB,d=this;a<this.gB&&(b=a);var e=this.yAa({pageSize:b});return this.HF=new Promise(function(b){e.then(function(e){d.HF=null;null!=e&&0<e.data.length&&(d.mq=e.data.length+e.startIndex,a<d.gB&&(e.maxCount=d.PB,e.maxCountLimit=!0));b(e)})})}return Promise.resolve({maxCount:this.PB,maxCountLimit:!0})};a.Sf.prototype.yAa=function(a){a=a||{};var b=a.pageSize;this.wk=this.wk?this.wk+b:b;if(-1==this.p.totalSize()||!this.xg()||this.xg()&&this.p.totalSize()>this.wk){var d=
this;return new Promise(function(a,c){d.p.fetch({startIndex:d.wk,pageSize:b}).then(function(b){a(b)},function(){c(null)})})}return Promise.resolve()};a.Sf.prototype.Bu=function(){this.wk=null;this.mq=0};a.Sf.prototype.BDa=function(a){this.wk=a.startIndex;0<a.data.length&&(this.mq=a.data.length+this.wk)};a.Sf.prototype.eea=function(c){return function(b){b=b||{};b=b.indexes;var d,e=b.length;for(d=0;d<e;d++){var f=b[d];void 0!==f&&0<this.mq&&f<=this.mq&&(c==a.ha.aa.ADD?this.mq+=1:c==a.ha.aa.REMOVE&&
(this.mq-=1))}}};a.Sf.prototype.xg=function(){var a=this.p;return null!=a&&"actual"==a.totalSizeConfidence()?!0:!1};a.Sf.prototype.ry=function(){var c=this.p;if(null!=c){this.wq();this.Jb=[];this.Jb.push({eventType:a.ha.aa.SORT,eventHandler:this.Bu.bind(this)});this.Jb.push({eventType:a.ha.aa.REFRESH,eventHandler:this.Bu.bind(this)});this.Jb.push({eventType:a.ha.aa.RESET,eventHandler:this.Bu.bind(this)});this.Jb.push({eventType:a.ha.aa.SYNC,eventHandler:this.BDa.bind(this)});this.Jb.push({eventType:a.ha.aa.ADD,
eventHandler:this.eea(a.ha.aa.ADD).bind(this)});this.Jb.push({eventType:a.ha.aa.REMOVE,eventHandler:this.eea(a.ha.aa.REMOVE).bind(this)});var b,d;for(b=0;b<this.Jb.length;b++)(d=c.on(this.Jb[b].eventType,this.Jb[b].eventHandler))&&(this.Jb[b].eventHandler=d)}};a.Sf.prototype.wq=function(){var a=this.p;if(null!=this.Jb&&null!=a){var b;for(b=0;b<this.Jb.length;b++)a.off(this.Jb[b].eventType,this.Jb[b].eventHandler)}}});